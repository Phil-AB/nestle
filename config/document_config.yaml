# Document Extraction and Storage Configuration
# Defines required fields, validation rules, and extraction settings for each document type

# ==============================================================================
# EXTRACTION STATUS CONFIGURATION
# ==============================================================================
extraction_status:
  complete: "complete"  # All required fields present
  incomplete: "incomplete"  # Some required fields missing
  failed: "failed"  # Extraction completely failed

# Confidence thresholds for extraction quality
confidence_thresholds:
  high: 0.90  # >= 90% confidence considered high quality
  medium: 0.70  # 70-89% confidence considered acceptable
  low: 0.50  # < 50% confidence requires manual review

# ==============================================================================
# INVOICE CONFIGURATION
# ==============================================================================
invoice:
  # Database model mapping
  model_name: Invoice  # SQLAlchemy model class name
  items_model_name: InvoiceItem  # SQLAlchemy model for line items
  table_name: invoices  # Database table name (for reference)
  items_table_name: invoice_items

  # Field that uniquely identifies the document (for duplicate detection)
  unique_field: invoice_number

  # Foreign key field linking items to parent document
  parent_fk_field: invoice_id

  required_fields:
    - invoice_number
    - currency

  optional_fields:
    - invoice_date
    - consignee_name
    - consignee_address
    - shipper_name
    - shipper_address
    - incoterm
    - total_fob_value
    - freight_value
    - insurance_value
    - total_invoice_value
    - language

  item_required_fields:
    - line_number

  item_optional_fields:
    - product_description
    - hs_code
    - country_of_origin
    - quantity
    - unit_of_measure
    - unit_price
    - total_value

  # Minimum items required for document to be valid
  min_items: 0

  # Whether this document type has line items
  has_items: true

# ==============================================================================
# BILL OF ENTRY (BOE) CONFIGURATION
# ==============================================================================
boe:
  # Database model mapping
  model_name: BillOfEntry
  items_model_name: BOEItem
  table_name: bill_of_entries
  items_table_name: boe_items

  # Field that uniquely identifies the document
  unique_field: declaration_number

  # Foreign key field linking items to parent document
  parent_fk_field: boe_id

  required_fields:
    - declaration_number
    - currency

  optional_fields:
    - declaration_date
    - consignee_name
    - consignee_address
    - shipper_name
    - shipper_address
    - fob_value
    - freight_value
    - insurance_value
    - cif_value
    - duty_value

  item_required_fields:
    - line_number

  item_optional_fields:
    - product_description
    - hs_code
    - country_of_origin
    - quantity
    - unit_of_measure
    - unit_value
    - total_value

  min_items: 0
  has_items: true

# ==============================================================================
# PACKING LIST CONFIGURATION
# ==============================================================================
packing_list:
  # Database model mapping
  model_name: PackingList
  items_model_name: PackingListItem
  table_name: packing_lists
  items_table_name: packing_list_items

  # Field that uniquely identifies the document
  unique_field: packing_list_number

  # Foreign key field linking items to parent document
  parent_fk_field: packing_list_id

  required_fields:
    - weight_unit

  optional_fields:
    - packing_list_number
    - packing_date
    - consignee_name
    - shipper_name
    - total_packages
    - total_gross_weight
    - total_net_weight

  item_required_fields:
    - line_number

  item_optional_fields:
    - product_description
    - quantity
    - unit_of_measure
    - package_number
    - gross_weight
    - net_weight

  min_items: 0
  has_items: true

# ==============================================================================
# CERTIFICATE OF ORIGIN (COO) CONFIGURATION
# ==============================================================================
coo:
  # Database model mapping
  model_name: CertificateOfOrigin
  items_model_name: COOItem
  table_name: certificates_of_origin
  items_table_name: coo_items

  # Field that uniquely identifies the document
  unique_field: certificate_number

  # Foreign key field linking items to parent document
  parent_fk_field: coo_id

  required_fields: []

  optional_fields:
    - certificate_number
    - issue_date
    - issuing_authority
    - exporter_name
    - exporter_address
    - consignee_name
    - consignee_address
    - country_of_origin

  item_required_fields:
    - line_number

  item_optional_fields:
    - product_description
    - hs_code
    - country_of_origin
    - quantity

  min_items: 0
  has_items: true

# ==============================================================================
# FREIGHT DOCUMENT CONFIGURATION
# ==============================================================================
freight:
  # Database model mapping
  model_name: FreightDocument
  items_model_name: null  # No items model for freight
  table_name: freight_documents
  items_table_name: null

  # Field that uniquely identifies the document
  unique_field: contract_number

  # Foreign key field linking items to parent document (N/A for freight)
  parent_fk_field: null

  required_fields:
    - currency

  optional_fields:
    - contract_number
    - contract_period_start
    - contract_period_end
    - base_freight
    - bunker_adjustment
    - total_freight
    - transport_mode

  # Freight documents don't have line items
  item_required_fields: []
  item_optional_fields: []

  min_items: 0
  has_items: false

# ==============================================================================
# DATA TRANSFORMATION RULES
# ==============================================================================
transformation:
  # Date format parsing priority
  date_formats:
    - "%Y-%m-%d"  # 2024-01-15
    - "%d/%m/%Y"  # 15/01/2024
    - "%m/%d/%Y"  # 01/15/2024
    - "%d-%m-%Y"  # 15-01-2024
    - "%Y%m%d"    # 20240115
    - "%d %B %Y"  # 15 January 2024
    - "%B %d, %Y" # January 15, 2024

  # Numeric fields that should be converted to Decimal
  decimal_fields:
    - fob_value
    - freight_value
    - insurance_value
    - cif_value
    - total_fob_value
    - total_invoice_value
    - total_freight
    - base_freight
    - bunker_adjustment
    - duty_value
    - quantity
    - unit_price
    - unit_value
    - total_value
    - gross_weight
    - net_weight
    - total_gross_weight
    - total_net_weight

  # Integer fields
  integer_fields:
    - line_number
    - total_packages

  # Currency normalization
  currency_mapping:
    USD: USD
    US$: USD
    $: USD
    EUR: EUR
    €: EUR
    GBP: GBP
    £: GBP

  # Default values for missing data
  defaults:
    currency: USD
    weight_unit: KG
    bunker_adjustment: 0
    extraction_status: incomplete
    extraction_confidence: 0.0

# ==============================================================================
# STORAGE CONFIGURATION
# ==============================================================================
storage:
  # Whether to update existing records or reject duplicates
  update_on_duplicate: true

  # Whether to store raw Reducto JSON
  store_raw_data: true

  # Whether to cascade delete items when document is deleted
  cascade_delete_items: true

  # Transaction timeout (seconds)
  transaction_timeout: 30
